version: 1
applications:
  - backend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            - amplifyPush --simple
            - npm run build
            - aws s3 sync "s3://n2v0ob4-u9glwmk" .serverless   # pull what we had before
            - npx serverless                                   # generate new
            - aws s3 sync .serverless "s3://n2v0ob4-u9glwmk"   # push to bucket
    frontend:
      phases:
        build:
          commands:
            - echo "Nothing to build here"
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
    appRoot: web